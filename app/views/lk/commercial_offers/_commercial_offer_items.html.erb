<script type="text/javascript">
$(function(){
  $("#change_price").click(function(){   
    $(this).hide();
    $("#delta_value, table th.g-hidden, table td.g-hidden").show();
  });
});
</script>

<%= form_tag calculate_lk_commercial_offer_path(@commercial_offer) do %>
<table width="100%">
  <tr>
    <th class="g-hidden"></th>
    <th></th>
    <th>Изображение</th>
    <th>Артикул</th>
    <th>Наименование</th>
    <th>Цена за шт</th>
    <th>Кол-во</th>
    <th>Сумма</th>
    <th></th>
  </tr>
  <% @commercial_offer.commercial_offer_items.each do |item| -%>
    <tr>
      <td class="checkbox g-hidden"><%= check_box_tag "co_items_ids[]", item.lk_product.id %></td>
      <td><%= link_to image_tag('edit.png'), edit_lk_commercial_offer_product_path(@commercial_offer, item)  %></td>
      <td><%= link_to_if item.lk_product.product, image_tag(item.lk_product && item.lk_product.picture ? item.lk_product.picture.url : "default_image.jpg"), product_path(item.lk_product.product), :target => "_blank" %></td>
      <td><%= item.lk_product.article %></td>
      <td><%= item.lk_product.short_name %></td>
      <td><%= price_ru_label item.lk_product.price  %></td>
      <td><%= text_field_tag "co_items[#{item.lk_product.id}]", item.quantity, :class => "inp-quantity" %></td>
      <td><%= price_ru_label item.lk_product.price * item.quantity %></td>
      <td><%= link_to image_tag('bin.png'), lk_commercial_offer_product_path(@commercial_offer, item), :method => :delete, :confirm => "Удалить товар из коммерческого предложения?"  %></td>
    </tr>
  <% end -%>
  <tr>
    <td colspan="3"><%= submit_tag "Пересчитать" %>
      <span style="margin-left:20px">
      <%= link_to 'Изменить стоимость', "#", :title => "Введите числовое значение, на величину которого хотите изменить стоимость выбранных товаров и выполните пересчет коммерческого предложения", :id => "change_price", :class => "pseudo-link"  %>
      <span class="g-hidden" id="delta_value">
        <%= label_tag :delta, "Изменить стоимость на:" %> <%= text_field_tag :delta, nil, :class => "inp-numeric" %> руб.
      </span>
      </span>
    </td>
    <td colspan="2">
    <%= label_tag :sale,"Скидка, %:" %> <%= text_field_tag :sale, @commercial_offer.sale, :class => "inp-quantity" %></td>
    <td>Итого:</td>
    <td><%= @commercial_offer.commercial_offer_items.sum(:quantity) %> шт.</td>
    <td colspan="2"><%= price_ru_label @commercial_offer.total_price_with_sale  %></td>
  </tr>
</table>
<% end %>

